---
import type { Props } from '@astrojs/starlight/props';
import Default from '@astrojs/starlight/components/MobileTableOfContents.astro';
import CopyPageButton from './CopyPageButton.astro';
---

<div class="mobile-toc-wrapper">
  <!-- Use JavaScript to inject the copy button into the default mobile TOC -->
  <Default {...Astro.props} />
  <div class="mobile-copy-button-container" style="display: none;">
    <CopyPageButton />
  </div>
</div>

<style>
  .mobile-toc-wrapper {
    position: relative;
  }

  .mobile-copy-button-container {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    display: flex;
    align-items: center;
    padding-right: 1rem;
    pointer-events: none;
    z-index: 10;
  }

  .mobile-copy-button-container :global(.copy-page-container) {
    pointer-events: all;
  }

  .mobile-copy-button-container :global(.copy-page-button) {
    width: 28px;
    height: 28px;
  }

  .mobile-copy-button-container :global(.copy-page-button svg) {
    width: 18px;
    height: 18px;
  }
</style>

<script>
  function initMobileCopyButton() {
    const wrapper = document.querySelector('.mobile-toc-wrapper');
    const copyButtonContainer = document.querySelector('.mobile-copy-button-container');
    const defaultMobileToc = wrapper?.querySelector('mobile-starlight-toc');
    const summary = defaultMobileToc?.querySelector('summary');

    if (wrapper && copyButtonContainer && summary) {
      // Show the copy button container
      copyButtonContainer.style.display = 'flex';

      // Position the button container to match the summary's exact dimensions and position
      const summaryStyles = window.getComputedStyle(summary);
      const summaryPadding = {
        top: parseInt(summaryStyles.paddingTop),
        right: parseInt(summaryStyles.paddingRight),
        bottom: parseInt(summaryStyles.paddingBottom),
        left: parseInt(summaryStyles.paddingLeft)
      };

      // Set the container to match the summary's height and padding
      copyButtonContainer.style.height = summary.offsetHeight + 'px';
      copyButtonContainer.style.paddingTop = summaryPadding.top + 'px';
      copyButtonContainer.style.paddingBottom = summaryPadding.bottom + 'px';
      copyButtonContainer.style.paddingRight = summaryPadding.right + 'px';
    }
  }

  // Initialize on DOM ready and on page navigation
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMobileCopyButton);
  } else {
    initMobileCopyButton();
  }

  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', initMobileCopyButton);
</script>
